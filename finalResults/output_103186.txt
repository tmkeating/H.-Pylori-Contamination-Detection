Synchronizing dataset to local scratch: /tmp/ricse03_h_pylori_data
Data synchronization complete.
Starting Training for Fold: 0 of 5 using convnext_tiny
--- Starting Run ID: 112 (Fold: 1/5, Model: convnext_tiny, SLURM Job: 103186) ---
Using device: cuda
Set float32 matmul precision to 'high' for A40 hardware optimization.
Using Data Path: /tmp/ricse03_h_pylori_data
Pre-processing: Using Standard ImageNet Normalization (IHC-mode).
--- Fold 1/5 Split ---
Total Patients: 155
Training Patients: 124
Validation Patients: 31
Independent Patient-level split:
 - Train: 124 patients, 102308 patches
 - Val:   31 patients, 27887 patches
Training distribution: Negative=49998, Contaminated=52310
Enabling torch.compile for convnext_tiny Optimization (5D)...
Using AdamW Optimizer for convnext_tiny stability...
Running on standard PyTorch (IPEX disabled).
Epoch 1/15
Train Loss: 0.2182 Acc: 0.6685
Val Loss: 0.2029 Acc: 0.7645
Best model saved to results/112_103186_f0_convnext_tiny_model_brain.pth (Val Loss: 0.2029)
Epoch 2/15
Train Loss: 0.1674 Acc: 0.7820
Val Loss: 0.2154 Acc: 0.7541
Epoch 3/15
Train Loss: 0.1565 Acc: 0.7971
Val Loss: 0.2248 Acc: 0.7651
Epoch 4/15
Train Loss: 0.1428 Acc: 0.8193
Val Loss: 0.1817 Acc: 0.7857
Best model saved to results/112_103186_f0_convnext_tiny_model_brain.pth (Val Loss: 0.1817)
Epoch 5/15
Train Loss: 0.1373 Acc: 0.8267
Val Loss: 0.3137 Acc: 0.7185
Epoch 6/15
Train Loss: 0.1268 Acc: 0.8431
Val Loss: 0.2240 Acc: 0.7774
Epoch 7/15
Train Loss: 0.1195 Acc: 0.8514
Val Loss: 0.3189 Acc: 0.7439
Epoch 8/15
Train Loss: 0.1133 Acc: 0.8603
Val Loss: 0.2665 Acc: 0.7345
Epoch 9/15
Train Loss: 0.1058 Acc: 0.8698
Val Loss: 0.2681 Acc: 0.7853
Epoch 10/15
Train Loss: 0.0996 Acc: 0.8781
Val Loss: 0.2696 Acc: 0.7746
Epoch 11/15
Train Loss: 0.0940 Acc: 0.8862
Val Loss: 0.3555 Acc: 0.7444
Epoch 12/15
Train Loss: 0.0907 Acc: 0.8913
Val Loss: 0.3248 Acc: 0.7499
Epoch 13/15
Train Loss: 0.0881 Acc: 0.8947
Val Loss: 0.3495 Acc: 0.7459
Epoch 14/15
Train Loss: 0.0847 Acc: 0.8989
Val Loss: 0.3541 Acc: 0.7453
Epoch 15/15
Train Loss: 0.0869 Acc: 0.8958
Val Loss: 0.3634 Acc: 0.7435
Training complete. Best Val Loss: 0.1817
Fold 0 finished.
Saved learning curves to results/112_103186_f0_convnext_tiny_learning_curves.png

Evaluating on Independent Hold-Out set from: /tmp/ricse03_h_pylori_data/HoldOut
Independent Patients in Hold-Out: 116
Total Patches in Hold-Out: 88794

Classification Report:
              precision    recall  f1-score   support

    Negative       0.62      0.91      0.73     47557
Contaminated       0.77      0.35      0.48     41237

    accuracy                           0.65     88794
   macro avg       0.69      0.63      0.61     88794
weighted avg       0.69      0.65      0.62     88794

Saved machine-readable report to results/112_103186_f0_convnext_tiny_evaluation_report.csv
Saved results/112_103186_f0_convnext_tiny_confusion_matrix.png
Saved results/112_103186_f0_convnext_tiny_roc_curve.png
Saved results/112_103186_f0_convnext_tiny_pr_curve.png
Saved results/112_103186_f0_convnext_tiny_probability_histogram.png
Generating Grad-CAM interpretability maps for convnext_tiny...
Saved Grad-CAM samples to results/112_103186_f0_convnext_tiny_gradcam_samples

--- Patient-Level Consensus Report (Independent Set) ---
Warning: Meta-model not found. Falling back to heuristic gates.
No Meta-Classifier found. Using Heuristic Gates (Fallback)...
Patient Consensus Report saved to: results/112_103186_f0_convnext_tiny_patient_consensus.csv

Detailed Patient-Level Metrics (Clinical Report):
PatientID   Actual Predicted  Mean_Prob  Max_Prob  Count_P90  Patch_Count Correct
   B22-01 Positive  Negative   0.169054  0.425537          0          486      No
   B22-02 Positive  Positive   0.603915  0.991211         91          391     Yes
   B22-03 Negative  Negative   0.169054  0.425537          0          486     Yes
   B22-04 Negative  Negative   0.235006  0.699707          0          287     Yes
   B22-05 Negative  Negative   0.307577  0.833496          0          810     Yes
   B22-06 Negative  Negative   0.272946  0.811035          0          891     Yes
   B22-07 Negative  Negative   0.214147  0.420166          0          154     Yes
   B22-08 Negative  Negative   0.164035  0.823242          0          321     Yes
   B22-09 Negative  Negative   0.292416  0.623047          0          360     Yes
  B22-100 Positive  Positive   0.509566  0.985840         58          400     Yes
  B22-105 Positive  Negative   0.297132  0.907227          2          412      No
   B22-10 Negative  Negative   0.379217  0.892578          0         1822     Yes
   B22-11 Negative  Negative   0.359331  0.847168          0         1217     Yes
  B22-120 Positive  Negative   0.515142  0.976074         38          719      No
  B22-128 Positive  Negative   0.509115  0.976562         22          184      No
   B22-12 Negative  Negative   0.379242  0.909668          2          821     Yes
  B22-130 Positive  Positive   0.351127  0.991211         55          849     Yes
  B22-132 Positive  Positive   0.610660  0.994141        203          729     Yes
  B22-134 Positive  Negative   0.464176  0.991211         27          296      No
  B22-135 Positive  Positive   0.610709  0.991699        197          688     Yes
  B22-136 Positive  Positive   0.490933  0.987793        136         1252     Yes
  B22-139 Positive  Negative   0.371972  0.970215          4          330      No
   B22-13 Negative  Negative   0.247539  0.841797          0         1104     Yes
  B22-146 Negative  Negative   0.219068  0.566406          0          325     Yes
   B22-14 Negative  Negative   0.369258  0.904785          1          676     Yes
  B22-159 Positive  Positive   0.436365  0.979980         85         1208     Yes
   B22-15 Negative  Negative   0.213871  0.663574          0         1206     Yes
  B22-161 Positive  Positive   0.409624  0.992188        158         1795     Yes
  B22-169 Positive  Positive   0.493282  0.986816         58          462     Yes
   B22-16 Negative  Negative   0.228719  0.723633          0          237     Yes
   B22-17 Positive  Negative   0.429923  0.987305         20          625      No
   B22-18 Positive  Positive   0.443763  0.994141        130          953     Yes
  B22-196 Negative  Negative   0.258030  0.465576          0          179     Yes
  B22-198 Negative  Negative   0.202129  0.425049          0          223     Yes
  B22-199 Negative  Negative   0.274430  0.689453          0          438     Yes
   B22-19 Positive  Positive   0.638153  0.993652        137          395     Yes
  B22-201 Negative  Negative   0.220907  0.668457          0          744     Yes
  B22-202 Negative  Negative   0.241313  0.860840          0          964     Yes
  B22-203 Negative  Negative   0.244547  0.825684          0          730     Yes
  B22-205 Negative  Negative   0.206552  0.623047          0          654     Yes
  B22-206 Positive  Negative   0.300141  0.860840          0          769      No
  B22-207 Negative  Negative   0.223750  0.735840          0          458     Yes
  B22-208 Negative  Negative   0.206511  0.750977          0         1419     Yes
  B22-209 Negative  Negative   0.225961  0.537598          0          677     Yes
   B22-20 Positive  Negative   0.310941  0.987305         28          720      No
  B22-211 Negative  Negative   0.290409  0.578125          0          377     Yes
  B22-212 Negative  Negative   0.205686  0.917969          1          898     Yes
  B22-213 Negative  Negative   0.199718  0.531250          0          520     Yes
  B22-215 Negative  Negative   0.253425  0.844727          0         1611     Yes
  B22-220 Negative  Negative   0.235097  0.761719          0         1212     Yes
  B22-222 Positive  Negative   0.481762  0.993164         33          742      No
  B22-224 Positive  Negative   0.373776  0.974121          8          341      No
  B22-225 Positive  Negative   0.446201  0.969238         12          637      No
  B22-226 Negative  Negative   0.248998  0.668945          0          269     Yes
  B22-227 Negative  Negative   0.174583  0.654297          0          773     Yes
  B22-229 Negative  Negative   0.195741  0.564941          0         2348     Yes
  B22-231 Positive  Positive   0.738944  0.993164        853         1839     Yes
  B22-233 Negative  Negative   0.227776  0.479736          0          308     Yes
  B22-236 Negative  Negative   0.190247  0.568359          0         1471     Yes
  B22-237 Negative  Negative   0.212847  0.558594          0          876     Yes
  B22-238 Negative  Negative   0.341609  0.715332          0          236     Yes
  B22-239 Negative  Negative   0.298460  0.729980          0          568     Yes
  B22-242 Negative  Negative   0.359824  0.841309          0          545     Yes
  B22-243 Negative  Negative   0.217575  0.731934          0          776     Yes
  B22-246 Negative  Negative   0.247076  0.551758          0          363     Yes
  B22-247 Negative  Negative   0.434035  0.876465          0         1182     Yes
  B22-252 Negative  Negative   0.199758  0.457275          0          342     Yes
  B22-255 Positive  Positive   0.654562  0.995117        426         1243     Yes
  B22-257 Negative  Negative   0.273802  0.884766          0          193     Yes
  B22-259 Negative  Negative   0.238758  0.800293          0         1217     Yes
  B22-261 Negative  Negative   0.244032  0.748047          0          330     Yes
  B22-262 Positive  Negative   0.293892  0.744629          0          644      No
  B22-263 Positive  Positive   0.455011  0.990723         45          323     Yes
  B22-266 Negative  Negative   0.213139  0.657715          0          832     Yes
  B22-267 Positive  Positive   0.570083  0.989258         76          366     Yes
  B22-268 Negative  Negative   0.235260  0.853027          0         1092     Yes
  B22-269 Negative  Negative   0.252234  0.601074          0          838     Yes
  B22-271 Negative  Negative   0.261760  0.831543          0         1135     Yes
  B22-272 Positive  Negative   0.316002  0.891602          0          565      No
  B22-273 Positive  Positive   0.553970  0.994629        116          439     Yes
  B22-281 Positive  Positive   0.482743  0.994141         95          560     Yes
  B22-282 Negative  Negative   0.211266  0.464111          0          338     Yes
  B22-283 Negative  Negative   0.225740  0.840332          0          418     Yes
  B22-285 Negative  Negative   0.278820  0.702637          0          556     Yes
  B22-286 Positive  Negative   0.251069  0.979980          2         1167      No
  B22-293 Positive  Negative   0.394737  0.932617          4          364      No
  B22-294 Positive  Negative   0.333070  0.979004          1          760      No
  B22-295 Positive  Negative   0.287221  0.964844          9          762      No
  B22-309 Positive  Positive   0.424005  0.984375         43          893     Yes
  B22-310 Positive  Positive   0.418751  0.992188        155         1034     Yes
  B22-314 Negative  Negative   0.271708  0.811035          0          349     Yes
  B22-315 Negative  Negative   0.199882  0.642090          0          607     Yes
   B22-31 Positive  Negative   0.443140  0.985352         17          456      No
   B22-32 Positive  Positive   0.349519  0.991699         64          803     Yes
   B22-36 Positive  Negative   0.324678  0.968262          7          379      No
   B22-39 Positive  Negative   0.441180  0.986816         37          371      No
   B22-41 Positive  Negative   0.430784  0.974121         20          444      No
   B22-44 Positive  Negative   0.362765  0.963867          1          945      No
   B22-48 Positive  Negative   0.608459  0.973145         13          580      No
   B22-49 Positive  Negative   0.327544  0.976562         13          986      No
   B22-58 Negative  Negative   0.185621  0.498047          0          283     Yes
   B22-62 Positive  Positive   0.702175  0.995605        265          637     Yes
   B22-65 Positive  Positive   0.787198  0.994141        250          434     Yes
   B22-66 Positive  Negative   0.533871  0.986328         19          349      No
   B22-69 Positive  Negative   0.352957  0.923828          1          385      No
   B22-72 Positive  Positive   0.769028  0.993652        923         2021     Yes
   B22-73 Positive  Negative   0.624972  0.979492         18          333      No
   B22-75 Positive  Positive   0.519757  0.992676        119         1199     Yes
   B22-78 Positive  Negative   0.561659  0.971191         15          195      No
   B22-79 Positive  Positive   0.721776  0.991699        201          798     Yes
   B22-81 Positive  Negative   0.324603  0.657715          0          134      No
   B22-82 Positive  Negative   0.229668  0.859375          0          598      No
   B22-85 Positive  Negative   0.256206  0.845215          0          814      No
   B22-88 Negative  Negative   0.372866  0.886230          0          139     Yes
   B22-89 Negative  Negative   0.454302  0.958496          2         7352     Yes
   B22-96 Positive  Negative   0.389109  0.965332          6         2034      No

Generating Patient-Level Visualizations...
Saved patient-level plots to results

Final Patient-Level Accuracy: 71.55%
