Synchronizing dataset to local scratch: /tmp/ricse03_h_pylori_data
Data synchronization complete.
Starting Training for Fold: 2 of 5 using convnext_tiny
--- Starting Run ID: 114 (Fold: 3/5, Model: convnext_tiny, SLURM Job: 103188) ---
Using device: cuda
Set float32 matmul precision to 'high' for A40 hardware optimization.
Using Data Path: /tmp/ricse03_h_pylori_data
Pre-processing: Using Standard ImageNet Normalization (IHC-mode).
--- Fold 3/5 Split ---
Total Patients: 155
Training Patients: 124
Validation Patients: 31
Independent Patient-level split:
 - Train: 124 patients, 111666 patches
 - Val:   31 patients, 18529 patches
Training distribution: Negative=59386, Contaminated=52280
Enabling torch.compile for convnext_tiny Optimization (5D)...
Using AdamW Optimizer for convnext_tiny stability...
Running on standard PyTorch (IPEX disabled).
Epoch 1/15
Train Loss: 0.2224 Acc: 0.6583
Val Loss: 0.1925 Acc: 0.6610
Best model saved to results/114_103188_f2_convnext_tiny_model_brain.pth (Val Loss: 0.1925)
Epoch 2/15
Train Loss: 0.1733 Acc: 0.7651
Val Loss: 0.1781 Acc: 0.7531
Best model saved to results/114_103188_f2_convnext_tiny_model_brain.pth (Val Loss: 0.1781)
Epoch 3/15
Train Loss: 0.1528 Acc: 0.8021
Val Loss: 0.1639 Acc: 0.7912
Best model saved to results/114_103188_f2_convnext_tiny_model_brain.pth (Val Loss: 0.1639)
Epoch 4/15
Train Loss: 0.1402 Acc: 0.8223
Val Loss: 0.1900 Acc: 0.7635
Epoch 5/15
Train Loss: 0.1314 Acc: 0.8338
Val Loss: 0.1907 Acc: 0.7970
Epoch 6/15
Train Loss: 0.1210 Acc: 0.8470
Val Loss: 0.1832 Acc: 0.7869
Epoch 7/15
Train Loss: 0.1125 Acc: 0.8605
Val Loss: 0.2220 Acc: 0.7878
Epoch 8/15
Train Loss: 0.1063 Acc: 0.8689
Val Loss: 0.2542 Acc: 0.7684
Epoch 9/15
Train Loss: 0.1005 Acc: 0.8762
Val Loss: 0.2644 Acc: 0.7632
Epoch 10/15
Train Loss: 0.0954 Acc: 0.8835
Val Loss: 0.2566 Acc: 0.7833
Epoch 11/15
Train Loss: 0.0904 Acc: 0.8914
Val Loss: 0.2554 Acc: 0.7844
Epoch 12/15
Train Loss: 0.0854 Acc: 0.8985
Val Loss: 0.2481 Acc: 0.7858
Epoch 13/15
Train Loss: 0.0828 Acc: 0.9016
Val Loss: 0.2777 Acc: 0.7828
Epoch 14/15
Train Loss: 0.0818 Acc: 0.9024
Val Loss: 0.2757 Acc: 0.7840
Epoch 15/15
Train Loss: 0.0808 Acc: 0.9045
Val Loss: 0.2777 Acc: 0.7829
Training complete. Best Val Loss: 0.1639
Fold 2 finished.
Saved learning curves to results/114_103188_f2_convnext_tiny_learning_curves.png

Evaluating on Independent Hold-Out set from: /tmp/ricse03_h_pylori_data/HoldOut
Independent Patients in Hold-Out: 116
Total Patches in Hold-Out: 88794

Classification Report:
              precision    recall  f1-score   support

    Negative       0.64      0.79      0.71     47557
Contaminated       0.67      0.49      0.57     41237

    accuracy                           0.65     88794
   macro avg       0.65      0.64      0.64     88794
weighted avg       0.65      0.65      0.64     88794

Saved machine-readable report to results/114_103188_f2_convnext_tiny_evaluation_report.csv
Saved results/114_103188_f2_convnext_tiny_confusion_matrix.png
Saved results/114_103188_f2_convnext_tiny_roc_curve.png
Saved results/114_103188_f2_convnext_tiny_pr_curve.png
Saved results/114_103188_f2_convnext_tiny_probability_histogram.png
Generating Grad-CAM interpretability maps for convnext_tiny...
Saved Grad-CAM samples to results/114_103188_f2_convnext_tiny_gradcam_samples

--- Patient-Level Consensus Report (Independent Set) ---
Warning: Meta-model not found. Falling back to heuristic gates.
No Meta-Classifier found. Using Heuristic Gates (Fallback)...
Patient Consensus Report saved to: results/114_103188_f2_convnext_tiny_patient_consensus.csv

Detailed Patient-Level Metrics (Clinical Report):
PatientID   Actual Predicted  Mean_Prob  Max_Prob  Count_P90  Patch_Count Correct
   B22-01 Positive  Negative   0.258024  0.547363          0          486      No
   B22-02 Positive  Positive   0.691212  0.991211        105          391     Yes
   B22-03 Negative  Negative   0.258024  0.547363          0          486     Yes
   B22-04 Negative  Negative   0.362104  0.777832          0          287     Yes
   B22-05 Negative  Negative   0.435451  0.840332          0          810     Yes
   B22-06 Negative  Negative   0.385028  0.917969          2          891     Yes
   B22-07 Negative  Negative   0.287581  0.752930          0          154     Yes
   B22-08 Negative  Negative   0.264220  0.734375          0          321     Yes
   B22-09 Negative  Negative   0.416863  0.731934          0          360     Yes
  B22-100 Positive  Positive   0.614459  0.986816         62          400     Yes
  B22-105 Positive  Negative   0.424785  0.972168         10          412      No
   B22-10 Negative  Negative   0.502606  0.953125         25         1822     Yes
   B22-11 Negative  Negative   0.478791  0.882812          0         1217     Yes
  B22-120 Positive  Positive   0.621387  0.982422         61          719     Yes
  B22-128 Positive  Negative   0.616575  0.977539         20          184      No
   B22-12 Negative  Negative   0.514536  0.919434          1          821     Yes
  B22-130 Positive  Positive   0.350342  0.987305         54          849     Yes
  B22-132 Positive  Positive   0.697828  0.989746        219          729     Yes
  B22-134 Positive  Negative   0.574867  0.986328         27          296      No
  B22-135 Positive  Positive   0.682206  0.991211        237          688     Yes
  B22-136 Positive  Positive   0.551923  0.989258        140         1252     Yes
  B22-139 Positive  Negative   0.507912  0.957031          7          330      No
   B22-13 Negative  Negative   0.345392  0.652832          0         1104     Yes
  B22-146 Negative  Negative   0.296334  0.628906          0          325     Yes
   B22-14 Negative  Negative   0.510293  0.934082          3          676     Yes
  B22-159 Positive  Positive   0.525619  0.981445         49         1208     Yes
   B22-15 Negative  Negative   0.345093  0.693848          0         1206     Yes
  B22-161 Positive  Positive   0.541090  0.989258        183         1795     Yes
  B22-169 Positive  Positive   0.575879  0.987305         65          462     Yes
   B22-16 Negative  Negative   0.294059  0.741699          0          237     Yes
   B22-17 Positive  Negative   0.562841  0.984863         23          625      No
   B22-18 Positive  Positive   0.533040  0.988770        119          953     Yes
  B22-196 Negative  Negative   0.370944  0.649902          0          179     Yes
  B22-198 Negative  Negative   0.309155  0.659668          0          223     Yes
  B22-199 Negative  Negative   0.411715  0.811035          0          438     Yes
   B22-19 Positive  Positive   0.693370  0.992676        126          395     Yes
  B22-201 Negative  Negative   0.316711  0.722656          0          744     Yes
  B22-202 Negative  Negative   0.362091  0.832520          0          964     Yes
  B22-203 Negative  Negative   0.309046  0.799805          0          730     Yes
  B22-205 Negative  Negative   0.282566  0.664551          0          654     Yes
  B22-206 Positive  Negative   0.434055  0.867188          0          769      No
  B22-207 Negative  Negative   0.334972  0.732422          0          458     Yes
  B22-208 Negative  Negative   0.314148  0.813477          0         1419     Yes
  B22-209 Negative  Negative   0.332230  0.670898          0          677     Yes
   B22-20 Positive  Negative   0.405681  0.975098         32          720      No
  B22-211 Negative  Negative   0.335198  0.718262          0          377     Yes
  B22-212 Negative  Negative   0.300765  0.832520          0          898     Yes
  B22-213 Negative  Negative   0.322402  0.710938          0          520     Yes
  B22-215 Negative  Negative   0.309458  0.730957          0         1611     Yes
  B22-220 Negative  Negative   0.330247  0.617676          0         1212     Yes
  B22-222 Positive  Positive   0.572967  0.988281         77          742     Yes
  B22-224 Positive  Negative   0.461819  0.976074          7          341      No
  B22-225 Positive  Positive   0.585084  0.985840         67          637     Yes
  B22-226 Negative  Negative   0.198801  0.690430          0          269     Yes
  B22-227 Negative  Negative   0.271331  0.663574          0          773     Yes
  B22-229 Negative  Negative   0.343782  0.763672          0         2348     Yes
  B22-231 Positive  Positive   0.773822  0.993652        941         1839     Yes
  B22-233 Negative  Negative   0.330221  0.638672          0          308     Yes
  B22-236 Negative  Negative   0.290044  0.705566          0         1471     Yes
  B22-237 Negative  Negative   0.337735  0.664062          0          876     Yes
  B22-238 Negative  Negative   0.421392  0.640625          0          236     Yes
  B22-239 Negative  Negative   0.386311  0.783691          0          568     Yes
  B22-242 Negative  Negative   0.454266  0.779785          0          545     Yes
  B22-243 Negative  Negative   0.311942  0.704590          0          776     Yes
  B22-246 Negative  Negative   0.345742  0.834961          0          363     Yes
  B22-247 Negative  Negative   0.529927  0.823730          0         1182     Yes
  B22-252 Negative  Negative   0.296978  0.642578          0          342     Yes
  B22-255 Positive  Positive   0.723923  0.993164        443         1243     Yes
  B22-257 Negative  Negative   0.374078  0.857422          0          193     Yes
  B22-259 Negative  Negative   0.370672  0.750977          0         1217     Yes
  B22-261 Negative  Negative   0.369173  0.736816          0          330     Yes
  B22-262 Positive  Negative   0.269722  0.712402          0          644      No
  B22-263 Positive  Positive   0.554134  0.987305         55          323     Yes
  B22-266 Negative  Negative   0.332885  0.680176          0          832     Yes
  B22-267 Positive  Positive   0.660420  0.991699        118          366     Yes
  B22-268 Negative  Negative   0.333503  0.677734          0         1092     Yes
  B22-269 Negative  Negative   0.331308  0.770996          0          838     Yes
  B22-271 Negative  Negative   0.317349  0.780273          0         1135     Yes
  B22-272 Positive  Negative   0.421205  0.958984          1          565      No
  B22-273 Positive  Positive   0.665227  0.992676        122          439     Yes
  B22-281 Positive  Positive   0.626429  0.991211        110          560     Yes
  B22-282 Negative  Negative   0.340562  0.629395          0          338     Yes
  B22-283 Negative  Negative   0.335213  0.712402          0          418     Yes
  B22-285 Negative  Negative   0.381115  0.758301          0          556     Yes
  B22-286 Positive  Negative   0.393734  0.979004          6         1167      No
  B22-293 Positive  Negative   0.527932  0.979980         30          364      No
  B22-294 Positive  Negative   0.431189  0.984375          2          760      No
  B22-295 Positive  Negative   0.391151  0.959961         11          762      No
  B22-309 Positive  Negative   0.463214  0.986816         39          893      No
  B22-310 Positive  Positive   0.435321  0.992188        150         1034     Yes
  B22-314 Negative  Negative   0.399179  0.810059          0          349     Yes
  B22-315 Negative  Negative   0.148528  0.701172          0          607     Yes
   B22-31 Positive  Positive   0.538463  0.982422         45          456     Yes
   B22-32 Positive  Positive   0.457295  0.990234         70          803     Yes
   B22-36 Positive  Negative   0.409414  0.981934          8          379      No
   B22-39 Positive  Positive   0.562472  0.990723         55          371     Yes
   B22-41 Positive  Negative   0.472062  0.976074         30          444      No
   B22-44 Positive  Negative   0.317477  0.959961          2          945      No
   B22-48 Positive  Negative   0.698555  0.980469         26          580      No
   B22-49 Positive  Negative   0.426287  0.978027         12          986      No
   B22-58 Negative  Negative   0.296277  0.659668          0          283     Yes
   B22-62 Positive  Positive   0.764425  0.991699        274          637     Yes
   B22-65 Positive  Positive   0.822790  0.990723        254          434     Yes
   B22-66 Positive  Negative   0.634975  0.977051         17          349      No
   B22-69 Positive  Negative   0.512971  0.938477          6          385      No
   B22-72 Positive  Positive   0.776681  0.991211        794         2021     Yes
   B22-73 Positive  Negative   0.702338  0.985840         28          333      No
   B22-75 Positive  Positive   0.574515  0.992676        183         1199     Yes
   B22-78 Positive  Positive   0.688772  0.991211         48          195     Yes
   B22-79 Positive  Positive   0.749775  0.988770        207          798     Yes
   B22-81 Positive  Negative   0.468399  0.751465          0          134      No
   B22-82 Positive  Negative   0.291301  0.949219          3          598      No
   B22-85 Positive  Negative   0.343026  0.744141          0          814      No
   B22-88 Negative  Negative   0.436267  0.783691          0          139     Yes
   B22-89 Negative  Negative   0.536661  0.908203          1         7352     Yes
   B22-96 Positive  Negative   0.489213  0.984375         14         2034      No

Generating Patient-Level Visualizations...
Saved patient-level plots to results

Final Patient-Level Accuracy: 75.86%
